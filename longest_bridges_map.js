let bridgesJson = [
    {
        "name": "Akashi Kaiky\u014d Bridge",
        "span": 1991,
        "span_text": "1,991m",
        "city": "Kobe",
        "location": [
            34.617028,
            135.021917
        ]
    },
    {
        "name": "Yangsigang Yangtze River Bridge",
        "span": 1700,
        "span_text": "1,700m",
        "city": "Wuhan",
        "location": [
            30.50667,
            114.25667
        ]
    },
    {
        "name": "Nansha Bridge(East span)",
        "span": 1688,
        "span_text": "1,688m",
        "city": "Dongguan",
        "location": [
            22.88475,
            113.565667
        ]
    },
    {
        "name": "Xihoumen Bridge",
        "span": 1650,
        "span_text": "1,650m",
        "city": "Zhoushan",
        "location": [
            30.061778,
            121.916
        ]
    },
    {
        "name": "Great Belt Bridge",
        "span": 1624,
        "span_text": "1,624m",
        "city": "Kors\u00f8r",
        "location": [
            55.34194,
            11.035917
        ]
    },
    {
        "name": "Osman Gazi Bridge",
        "span": 1550,
        "span_text": "1,550m",
        "city": "Dilovas\u0131",
        "location": [
            40.75417,
            29.51528
        ]
    },
    {
        "name": "Yi Sun-sin Bridge",
        "span": 1545,
        "span_text": "1,545m",
        "city": "Gwangyang",
        "location": [
            34.905944,
            127.705028
        ]
    },
    {
        "name": "Runyang Bridge",
        "span": 1490,
        "span_text": "1,490m",
        "city": "Yangzhou",
        "location": [
            32.206833,
            119.363861
        ]
    },
    {
        "name": "Second Dongtinghu Bridge [zh]",
        "span": 1480,
        "span_text": "1,480m",
        "city": "Yueyang",
        "location": [
            29.42472,
            113.12222
        ]
    },
    {
        "name": "Nanjing Fourth Yangtze Bridge",
        "span": 1418,
        "span_text": "1,418m",
        "city": "Nanjing",
        "location": [
            32.17775,
            118.940139
        ]
    },
    {
        "name": "Humber Bridge",
        "span": 1410,
        "span_text": "1,410m",
        "city": "Hessle",
        "location": [
            53.707972,
            -0.450083
        ]
    },
    {
        "name": "Yavuz Sultan Selim Bridge",
        "span": 1408,
        "span_text": "1,408m",
        "city": "\u0130stanbul",
        "location": [
            41.20861,
            29.11806
        ]
    },
    {
        "name": "Jiangyin Bridge",
        "span": 1385,
        "span_text": "1,385m",
        "city": "Jiangyin",
        "location": [
            31.945306,
            120.26944
        ]
    },
    {
        "name": "Tsing Ma Bridge",
        "span": 1377,
        "span_text": "1,377m",
        "city": "Tsing Yi",
        "location": [
            22.351333,
            114.073778
        ]
    },
    {
        "name": "Hardanger Bridge",
        "span": 1310,
        "span_text": "1,310m",
        "city": "Ulvik",
        "location": [
            60.478583,
            6.829778
        ]
    },
    {
        "name": "Verrazzano-Narrows Bridge",
        "span": 1298,
        "span_text": "1,298m",
        "city": "New York City",
        "location": [
            40.60639,
            -74.045333
        ]
    },
    {
        "name": "Golden Gate Bridge",
        "span": 1280,
        "span_text": "1,280m",
        "city": "San Francisco",
        "location": [
            37.819306,
            -122.478861
        ]
    },
    {
        "name": "Yangluo Bridge",
        "span": 1280,
        "span_text": "1,280m",
        "city": "Wuhan",
        "location": [
            30.636917,
            114.554944
        ]
    },
    {
        "name": "H\u00f6ga Kusten Bridge",
        "span": 1210,
        "span_text": "1,210m",
        "city": "Utansj\u00f6",
        "location": [
            62.79806,
            17.9375
        ]
    },
    {
        "name": "Nansha Bridge(West span)",
        "span": 1200,
        "span_text": "1,200m",
        "city": "Dongguan",
        "location": [
            22.883278,
            113.518889
        ]
    },
    {
        "name": "Longjiang River Bridge",
        "span": 1196,
        "span_text": "1,196m",
        "city": "Wuhexiang",
        "location": [
            24.838806,
            98.672194
        ]
    },
    {
        "name": "Aizhai Bridge",
        "span": 1176,
        "span_text": "1,176m",
        "city": "Jishou",
        "location": [
            28.331694,
            109.598111
        ]
    },
    {
        "name": "Mackinac Bridge",
        "span": 1158,
        "span_text": "1,158m",
        "city": "Mackinaw City",
        "location": [
            45.81556,
            -84.727944
        ]
    },
    {
        "name": "Ulsan Bridge [ko]",
        "span": 1150,
        "span_text": "1,150m",
        "city": "Ulsan",
        "location": [
            35.51139,
            129.39111
        ]
    },
    {
        "name": "H\u00e5logaland Bridge",
        "span": 1145,
        "span_text": "1,145m",
        "city": "Rombaken",
        "location": [
            68.45889,
            17.48222
        ]
    },
    {
        "name": "Qingshui River Bridge",
        "span": 1130,
        "span_text": "1,130m",
        "city": "Kaiyang County",
        "location": [
            27.030417,
            107.189333
        ]
    },
    {
        "name": "Huangpu Bridge",
        "span": 1108,
        "span_text": "1,108m",
        "city": "Guangzhou",
        "location": [
            23.071417,
            113.476083
        ]
    },
    {
        "name": "Minami Bisan-Seto Bridge",
        "span": 1100,
        "span_text": "1,100m",
        "city": "Sakaide",
        "location": [
            34.36389,
            133.825194
        ]
    },
    {
        "name": "Xingkang Bridge\u5174\u5eb7\u5927\u6865",
        "span": 1100,
        "span_text": "1,100m",
        "city": "Luding County",
        "location": [
            29.965389,
            102.214889
        ]
    },
    {
        "name": "Wufengshan Yangtze River Bridge\n\u4e94\u5cf0\u5c71\u957f\u6c5f\u5927\u6865",
        "span": 1092,
        "span_text": "1,092m",
        "city": "Zhenjiang",
        "location": [
            32.2267389,
            119.6765
        ]
    },
    {
        "name": "Fatih Sultan Mehmet Bridge",
        "span": 1090,
        "span_text": "1,090m",
        "city": "\u0130stanbul",
        "location": [
            41.09111,
            29.06111
        ]
    },
    {
        "name": "Baling River Bridge",
        "span": 1088,
        "span_text": "1,088m",
        "city": "Guanling Buyei and Miao Autonomous County",
        "location": [
            25.96111,
            105.62944
        ]
    },
    {
        "name": "Taizhou Bridge",
        "span": 1080,
        "span_text": "1,080m",
        "city": "Taizhou",
        "location": [
            32.246611,
            119.876694
        ]
    },
    {
        "name": "Ma'anshan Bridge",
        "span": 1080,
        "span_text": "1,080m",
        "city": "Ma'anshan",
        "location": [
            31.610111,
            118.392056
        ]
    },
    {
        "name": "Bosphorus Bridge",
        "span": 1074,
        "span_text": "1,074m",
        "city": "\u0130stanbul",
        "location": [
            41.045,
            29.03389
        ]
    },
    {
        "name": "George Washington Bridge",
        "span": 1067,
        "span_text": "1,067m",
        "city": "New York City",
        "location": [
            40.851722,
            -73.952722
        ]
    },
    {
        "name": "Fuma Yangtze River Bridge\u9a78\u9a6c\u957f\u6c5f\u5927\u6865",
        "span": 1050,
        "span_text": "1,050m",
        "city": "Wanzhou",
        "location": [
            30.834667,
            108.469278
        ]
    },
    {
        "name": "Qipanzhou Yangtse River Bridge\u68cb\u76d8\u6d32\u957f\u6c5f\u5927\u6865",
        "span": 1038,
        "span_text": "1,038m",
        "city": "Huangshi",
        "location": [
            30.1525778,
            115.2672972
        ]
    },
    {
        "name": "Third Kurushima-Kaiky\u014d Bridge",
        "span": 1030,
        "span_text": "1,030m",
        "city": "Imabari",
        "location": [
            34.11525,
            132.984333
        ]
    },
    {
        "name": "Second Kurushima-Kaiky\u014d Bridge",
        "span": 1020,
        "span_text": "1,020m",
        "city": "Umashima Island",
        "location": [
            34.12111,
            133.000194
        ]
    },
    {
        "name": "25 de Abril Bridge",
        "span": 1013,
        "span_text": "1,013m",
        "city": "Lisbon",
        "location": [
            38.689861,
            -9.177167
        ]
    },
    {
        "name": "Forth Road Bridge",
        "span": 1006,
        "span_text": "1,006m",
        "city": "South Queensferry",
        "location": [
            56.0015,
            -3.404194
        ]
    },
    {
        "name": "Yidu Yangtse River Bridge [zh]\u5b9c\u90fd\u957f\u6c5f\u516c\u8def\u5927\u6865",
        "span": 1000,
        "span_text": "1,000m",
        "city": "Yidu",
        "location": [
            30.40917,
            111.51667
        ]
    },
    {
        "name": "Kita Bisan-Seto Bridge",
        "span": 990,
        "span_text": "990m",
        "city": "Sakaide",
        "location": [
            34.378444,
            133.820333
        ]
    },
    {
        "name": "Severn Bridge",
        "span": 988,
        "span_text": "988m",
        "city": "Bristol",
        "location": [
            51.610056,
            -2.640667
        ]
    },
    {
        "name": "Yichang Bridge",
        "span": 960,
        "span_text": "960m",
        "city": "Yichang",
        "location": [
            30.569583,
            111.391528
        ]
    },
    {
        "name": "Shimotsui-Seto Bridge",
        "span": 940,
        "span_text": "940m",
        "city": "Kojima",
        "location": [
            34.431222,
            133.806444
        ]
    },
    {
        "name": "Xiushan Bridge",
        "span": 926,
        "span_text": "926m",
        "city": "Daishan",
        "location": [
            30.21111,
            122.185361
        ]
    },
    {
        "name": "Xiling Bridge",
        "span": 900,
        "span_text": "900m",
        "city": "Sandouping",
        "location": [
            30.828472,
            111.04667
        ]
    },
    {
        "name": "Si Du River Bridge",
        "span": 900,
        "span_text": "900m",
        "city": "Yesanguan",
        "location": [
            30.621139,
            110.395306
        ]
    },
    {
        "name": "Second Namhae Bridge\uc81c2\ub0a8\ud574\ub300\uad50",
        "span": 890,
        "span_text": "890m",
        "city": "Namhaedo",
        "location": [
            34.942889,
            127.866278
        ]
    },
    {
        "name": "Humen Pearl River Bridge",
        "span": 888,
        "span_text": "888m",
        "city": "Dongguan",
        "location": [
            22.797083,
            113.615889
        ]
    },
    {
        "name": "Cuntan Yangtze River Bridge [zh]\u5bf8\u6ee9\u957f\u6c5f\u5927\u6865",
        "span": 880,
        "span_text": "880m",
        "city": "Chongqing",
        "location": [
            29.620611,
            106.606056
        ]
    },
    {
        "name": "\u014cnaruto Bridge",
        "span": 876,
        "span_text": "876m",
        "city": "Naruto",
        "location": [
            34.23875,
            134.650306
        ]
    },
    {
        "name": "Lishui River Bridge",
        "span": 856,
        "span_text": "856m",
        "city": "Zhangjiajie",
        "location": [
            29.09861,
            110.24667
        ]
    },
    {
        "name": "Second Tacoma Narrows Bridge(westbound)",
        "span": 853,
        "span_text": "853m",
        "city": "Tacoma",
        "location": [
            47.268222,
            -122.550194
        ]
    },
    {
        "name": "Third Tacoma Narrows Bridge(eastbound)",
        "span": 853,
        "span_text": "853m",
        "city": "Tacoma",
        "location": [
            47.267889,
            -122.550778
        ]
    },
    {
        "name": "Ask\u00f8y Bridge",
        "span": 850,
        "span_text": "850m",
        "city": "Bergen",
        "location": [
            60.395444,
            5.215222
        ]
    },
    {
        "name": "Yingwuzhou Bridge",
        "span": 850,
        "span_text": "850m",
        "city": "Wuhan",
        "location": [
            30.534056,
            114.276889
        ]
    },
    {
        "name": "Jeokgeum Bridge [ko]",
        "span": 850,
        "span_text": "850m",
        "city": "Ucheon",
        "location": [
            34.63139,
            127.50278
        ]
    },
    {
        "name": "Zhixi Yangtze River Bridge [zh] \u81f3\u559c\u957f\u6c5f\u5927\u6865\uff08\u5e99\u5634\u957f\u6c5f\u5927\u6865\uff09",
        "span": 838,
        "span_text": "838m",
        "city": "Yichang",
        "location": [
            30.715611,
            111.262556
        ]
    },
    {
        "name": "Nanxi Bridge",
        "span": 820,
        "span_text": "820m",
        "city": "Nanxi District",
        "location": [
            28.783694,
            104.945694
        ]
    },
    {
        "name": "Taihong Yangtze River Bridge [zh]\u592a\u6d2a\u957f\u6c5f\u5927\u6865",
        "span": 808,
        "span_text": "808m",
        "city": "Chongqing",
        "location": [
            29.6632889,
            106.89333
        ]
    },
    {
        "name": "Qincaobei Bridge",
        "span": 788,
        "span_text": "788m",
        "city": "Lidu",
        "location": [
            29.714306,
            107.281306
        ]
    },
    {
        "name": "Innoshima Bridge",
        "span": 770,
        "span_text": "770m",
        "city": "Innoshima",
        "location": [
            34.357139,
            133.180417
        ]
    },
    {
        "name": "Jinshajiang Hutiaoxia Bridge\n\u91d1\u6c99\u6c5f\u5927\u6865\uff08\u9999\u4e3d\u9ad8\u901f\uff09",
        "span": 766,
        "span_text": "766m",
        "city": "Hutiaoxiazhen",
        "location": [
            27.17417,
            100.08389
        ]
    },
    {
        "name": "Akinada Bridge",
        "span": 750,
        "span_text": "750m",
        "city": "Kure",
        "location": [
            34.206222,
            132.679389
        ]
    },
    {
        "name": "Semey Bridge",
        "span": 750,
        "span_text": "750m",
        "city": "Semey",
        "location": [
            50.40972,
            80.22444
        ]
    },
    {
        "name": "Yuecheng Xijiang Bridge\u60a6\u57ce\u897f\u6c5f\u5927\u6865",
        "span": 738,
        "span_text": "738m",
        "city": "Yunfu",
        "location": [
            23.09361,
            112.21056
        ]
    },
    {
        "name": "Jinshajiang Jindong Bridge\u91d1\u4e1c\u5927\u6865",
        "span": 730,
        "span_text": "730m",
        "city": "Huidong County",
        "location": [
            26.50925,
            103.040194
        ]
    },
    {
        "name": "New Carquinez Bridge",
        "span": 728,
        "span_text": "728m",
        "city": "Vallejo",
        "location": [
            38.061028,
            -122.226528
        ]
    },
    {
        "name": "Hakuch\u014d Bridge",
        "span": 720,
        "span_text": "720m",
        "city": "Muroran",
        "location": [
            42.352889,
            140.950333
        ]
    },
    {
        "name": "Angostura Bridge",
        "span": 712,
        "span_text": "712m",
        "city": "Ciudad Bol\u00edvar",
        "location": [
            8.144417,
            -63.598111
        ]
    },
    {
        "name": "Kanmon Bridge",
        "span": 712,
        "span_text": "712m",
        "city": "Kitakyushu",
        "location": [
            33.961722,
            130.958694
        ]
    },
    {
        "name": "San Francisco\u2013Oakland Bay Bridge(east half of west span)",
        "span": 704,
        "span_text": "704m",
        "city": "San Francisco",
        "location": [
            37.803389,
            -122.371917
        ]
    },
    {
        "name": "San Francisco\u2013Oakland Bay Bridge(west half of west span)",
        "span": 704,
        "span_text": "704m",
        "city": "San Francisco",
        "location": [
            37.793167,
            -122.38306
        ]
    },
    {
        "name": "Bronx\u2013Whitestone Bridge",
        "span": 701,
        "span_text": "701m",
        "city": "New York City",
        "location": [
            40.801861,
            -73.829778
        ]
    },
    {
        "name": "Maputo\u2013Katembe bridge",
        "span": 680,
        "span_text": "680m",
        "city": "Maputo",
        "location": [
            -25.973167,
            32.557417
        ]
    },
    {
        "name": "Stord Bridge",
        "span": 677,
        "span_text": "677m",
        "city": "Stord",
        "location": [
            59.74806,
            5.402944
        ]
    },
    {
        "name": "Pierre Laporte Bridge",
        "span": 668,
        "span_text": "668m",
        "city": "Quebec City",
        "location": [
            46.745222,
            -71.290472
        ]
    },
    {
        "name": "Sunxihe Bridge\u7b0b\u6eaa\u6cb3\u5927\u6865",
        "span": 660,
        "span_text": "660m",
        "city": "Bailinzhen",
        "location": [
            28.712417,
            106.462333
        ]
    },
    {
        "name": "Delaware Memorial Bridge(northbound)",
        "span": 656,
        "span_text": "656m",
        "city": "New Castle",
        "location": [
            39.688972,
            -75.51806
        ]
    },
    {
        "name": "Delaware Memorial Bridge(southbound)",
        "span": 656,
        "span_text": "656m",
        "city": "New Castle",
        "location": [
            39.688389,
            -75.518389
        ]
    },
    {
        "name": "Jinshajiang Hulukou Bridge",
        "span": 656,
        "span_text": "656m",
        "city": "Hulukouzhen",
        "location": [
            26.971222,
            102.891722
        ]
    },
    {
        "name": "Second Saecheonnyeon Bridge [ko]\ucc9c\uc0ac\ub300\uad50",
        "span": 650,
        "span_text": "650m",
        "city": "Mokpo",
        "location": [
            34.860361,
            126.2055
        ]
    },
    {
        "name": "Haicang Bridge",
        "span": 648,
        "span_text": "648m",
        "city": "Xiamen",
        "location": [
            24.497278,
            118.068667
        ]
    },
    {
        "name": "Beipan River Hukun Expressway Bridge",
        "span": 636,
        "span_text": "636m",
        "city": "Qinglong County",
        "location": [
            25.899472,
            105.32361
        ]
    },
    {
        "name": "Taoyuan Jinsha River Bridge\u5927\u6c38\u9ad8\u901f\u6d9b\u6e90\u91d1\u6c99\u6c5f\u5927\u6865",
        "span": 636,
        "span_text": "636m",
        "city": "Yongsheng County",
        "location": [
            26.18389,
            100.59083
        ]
    },
    {
        "name": "Puli Bridge",
        "span": 628,
        "span_text": "628m",
        "city": "Pulixiang",
        "location": [
            26.322389,
            104.58778
        ]
    },
    {
        "name": "Gjemnessund Bridge",
        "span": 623,
        "span_text": "623m",
        "city": "Gjemnes",
        "location": [
            62.97139,
            7.77972
        ]
    },
    {
        "name": "Yuzui Yangtze Bridge",
        "span": 616,
        "span_text": "616m",
        "city": "Yuzuizhen",
        "location": [
            29.611306,
            106.772556
        ]
    },
    {
        "name": "Walt Whitman Bridge",
        "span": 610,
        "span_text": "610m",
        "city": "Philadelphia",
        "location": [
            39.905194,
            -75.129472
        ]
    },
    {
        "name": "Tancarville Bridge",
        "span": 608,
        "span_text": "608m",
        "city": "Tancarville",
        "location": [
            49.472667,
            0.464667
        ]
    },
    {
        "name": "New Little Belt Bridge",
        "span": 600,
        "span_text": "600m",
        "city": "Middelfart",
        "location": [
            55.518639,
            9.749139
        ]
    },
    {
        "name": "First Kurushima-Kaiky\u014d Bridge",
        "span": 600,
        "span_text": "600m",
        "city": "Umashima Island",
        "location": [
            34.125806,
            133.012528
        ]
    },
    {
        "name": "E'gongyan Rail Transit Bridge",
        "span": 600,
        "span_text": "600m",
        "city": "Chongqing",
        "location": [
            29.522194,
            106.528222
        ]
    },
    {
        "name": "E'gongyan Bridge",
        "span": 600,
        "span_text": "600m",
        "city": "Chongqing",
        "location": [
            29.523306,
            106.52825
        ]
    }
]
let centerPoint = [0,0]  // Array of latitude and longitude
let zoomLevel = 3  // 1 = whole world, 10 = large city, 20 = city blocks

// Create the map
let map = L.map('college-map').setView(centerPoint, zoomLevel)

// Add the tile layer - roads, streets etc. Without this, nothing to see
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copywrite">OpenStreetMap</a>',
}).addTo(map)


// Add some markers for Minneapolis College and Saint Paul College
// let mctcCoordinates = [44.9724, -93.2844]
// let mctcMarker = L.marker(mctcCoordinates)
//     .bindPopup('Minnepolis College<br><a href="https://minneapolis.edu" target="_blank" rel="noreferrer noopener">Website</a>')
//     .addTo(map)
//
// let stPaulCoordinates = [44.94839, -93.1099]
// let stpMarker = L.marker(stPaulCoordinates)
//     .bindPopup('Saint Paul College<br><a href="https://saintpaul.edu" target="_blank" rel="noreferrer noopener">Website</a>')
//     .addTo(map)


// Add a circle approximately around the Twin Cities metro
// let metroAreaCircle = L.circle(metroAreaCenterCoordinates, {
//     color: 'green',    // use any CSS color name
//     radius: 30000,
//     fillOpacity: 0.1
// })
    .bindPopup("Twin Cities Metro Area")
    .addTo(map)

let largestIndex = null
let largestBridgeSpan = 0
let markerArray  = []
let customMarkerIcon = L.icon({
    iconUrl: "bridge.png",
    iconSize: 40,
    iconAnchor: [25,25]
})
let customMarkerIconColored = L.icon({
    iconUrl: "bridge.png",
    iconSize: 50,
    iconAnchor: [25,25],
    // find a way to use this to css the color on the img
    className: "to-be-colored"
})
let canvas = document.querySelector("#bridge-chart")
let ctx = canvas.getContext("2d")


function getRandomColor() {
    let red = Math.floor((Math.random() *245)+10)
    let green = Math.floor((Math.random() * 245)+10)
    let blue = Math.floor((Math.random() * 245) +10)
    return `rgb(${red},${green},${blue}`
}

let chart = new Chart(ctx, {
        type: "bar",
        data: {
            datasets: [
                {
                    data:[],
                    backgroundColor: [],
                }
            ],
            labels: []

        },
        options: {}
    })

function addBridgeToChart(name, span) {

    // add expense to chart
    chart.data.labels.push(name)
    chart.data.datasets[0].data.push(span)
    chart.data.datasets[0].backgroundColor.push(getRandomColor())
    chart.update()
}


bridgesJson.forEach(function (bridge, index){
    let bridgeName = bridge.name
    let bridgeCity = bridge.city
    let bridgeSpan = bridge.span
    let mapMarker = L.marker(bridge.location,{icon: customMarkerIcon})
        .bindPopup(`name: ${bridgeName}<br>City: ${bridgeCity}<br>Lenghth: ${bridge.span_text}`)
        .addTo(map)
    markerArray.push(mapMarker)
    if (bridge.span > largestBridgeSpan) {
        largestBridgeSpan = bridgeSpan
        largestIndex = index
    }
    addBridgeToChart(bridgeName,bridgeSpan)
})
if (largestIndex !== null) {
    markerArray[largestIndex].remove()
    let bridge = bridgesJson[largestIndex]
    let mapMarker = L.marker(bridge.location,{icon: customMarkerIconColored})
        .bindPopup(`name: ${bridge.name}<br>City: ${bridge.city}<br><b>Lenghth: ${bridge.span_text}</b>`)
        .addTo(map)
    markerArray.push(mapMarker)
}
